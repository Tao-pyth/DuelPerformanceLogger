#:kivy 2.2.1
#:import dp kivy.metrics.dp

<SettingsScreen>:
    MDBoxLayout:
        orientation: "vertical"

        AppToolbar:
            title: root.t("settings.header_title")
            left_action_items: [["arrow-left", lambda x: root.change_screen("menu")]]
            right_action_items: [["home", lambda x: root.change_screen("menu")]]

        MDScrollView:
            MDBoxLayout:
                orientation: "vertical"
                padding: (dp(24), dp(24), dp(24), dp(24))
                spacing: dp(16)
                size_hint_y: None
                height: self.minimum_height

                SettingsSectionCard:
                    MDLabel:
                        text: root.t("settings.ui_section_title")
                        font_style: "Subtitle1"
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDLabel:
                        text: root.t("settings.ui_mode_description")
                        theme_text_color: "Secondary"
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDBoxLayout:
                        spacing: dp(12)
                        size_hint_y: None
                        height: dp(48)

                        MDRectangleFlatIconButton:
                            text: root.t("settings.mode_normal")
                            icon: "monitor"
                            size_hint: 1, None
                            height: dp(48)
                            md_bg_color: app.theme_cls.primary_color if root.selected_mode == "normal" else (1, 1, 1, 1)
                            text_color: (1, 1, 1, 1) if root.selected_mode == "normal" else app.theme_cls.primary_color
                            line_color: app.theme_cls.primary_color
                            on_release: root._set_ui_mode("normal")

                        MDRectangleFlatIconButton:
                            text: root.t("settings.mode_broadcast")
                            icon: "cast"
                            size_hint: 1, None
                            height: dp(48)
                            md_bg_color: app.theme_cls.primary_color if root.selected_mode == "broadcast" else (1, 1, 1, 1)
                            text_color: (1, 1, 1, 1) if root.selected_mode == "broadcast" else app.theme_cls.primary_color
                            line_color: app.theme_cls.primary_color
                            on_release: root._set_ui_mode("broadcast")

                SettingsSectionCard:
                    MDLabel:
                        text: root.t("settings.db_section_title")
                        font_style: "Subtitle1"
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDLabel:
                        text: root.t("settings.backup_description")
                        theme_text_color: "Secondary"
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]

                    MDLabel:
                        text: root.backup_info
                        theme_text_color: "Hint"
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]

                    PrimaryRaisedButton:
                        text: root.t("settings.backup_button")
                        on_release: root.create_backup()

                    MDLabel:
                        text: root.t("settings.db_init_description")
                        theme_text_color: "Secondary"
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]

                    PrimaryRaisedButton:
                        text: root.t("settings.db_init_button")
                        on_release: root.open_db_init_dialog()

        MDBoxLayout:
            padding: (dp(24), dp(12), dp(24), dp(24))
            size_hint_y: None
            height: dp(72)

            Widget:

            PrimaryRaisedButton:
                text: root.t("common.exit")
                size_hint_x: None
                width: dp(200)
                on_release: root.exit_app()

    ConfirmDialog:
        id: db_init_dialog
        title_text: root.t("settings.db_init_button")
        message_text: root.t("settings.db_init_confirm")
        ok_text: root.t("common.execute")
        cancel_text: root.t("common.cancel")
        ok_callback: root._perform_db_initialization
        cancel_callback: root._dismiss_dialog
